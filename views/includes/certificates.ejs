<% layout('layouts/boilerplate') %>

<div class="main-wrapper d-flex">
  <main class="main-content flex-grow-1">
    <div class="dashboard-header mb-4">
      <h2>Certificates</h2>
      <p>View and download your earned certificates</p>
    </div>

    <% if (completedCourses && completedCourses.length > 0) { %>
    <!-- Summary Card -->
    <div class="alert alert-success d-flex align-items-center mb-4" role="alert" style="border-radius: 12px">
      <i class="fa-solid fa-award me-2"></i>
      <div>
        <strong>You've earned <%= completedCourses.length %> certificate<%= completedCourses.length > 1 ? 's' : '' %>!</strong><br />
        <span class="text-secondary">Keep up the great work in your learning journey</span>
      </div>
    </div>

    <!-- Certificates Grid -->
    <div class="certificate-grid">
      <% completedCourses.forEach(course => { %> 
        <% if (Number(course.progress) === 100) { %>

        <div class="certificate-card">
          <div class="certificate-banner">
            <i class="fa-solid fa-award"></i>
          </div>

          <div class="certificate-body text-center">
            <h5><%= course.title %></h5>

            <!-- âœ… Added certificate preview container for Puppeteer -->
            <div class="certificate-container d-none">
              <div style="width:1000px; background:white; border:10px solid gold; border-radius:16px; padding:50px; text-align:center;">
                <h1 style="font-weight:700; margin-bottom:10px;">Certificate of Completion</h1>
                <p>This is to certify that</p>
                <h2><%= user.name %></h2>
                <p>has successfully completed the course</p>
                <h3><%= course.title %></h3>
                <p style="margin-top:30px;">Awarded by <strong>GTB Learning Platform</strong></p>
              </div>
            </div>

            <a href="/download_certificate_image?course=<%= course.title %>&download=true" class="btn-download mt-3">
              <i class="fa-solid fa-download me-1"></i> Download Certificate
            </a>
          </div>
        </div>

      <% } %> 
      <% }) %>
    </div>

    <% } else { %>
    <div class="alert alert-info" style="border-radius: 12px">
      <h5>No certificates yet ðŸŽ“</h5>
      <p>Complete your courses to earn certificates.</p>
    </div>
    <% } %>
  </main>
</div>
