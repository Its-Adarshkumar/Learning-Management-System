<% layout('layouts/boilerplate') %>

<div class="d-flex">
  <%- include("../includes/admin_sidebar.ejs") %>

  <main class="main-content flex-grow-1 p-4">
    <!-- Header -->
    <div class="dashboard-header d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2>Welcome, Admin</h2>
        <p>Hereâ€™s an overview of your uploaded content.</p>
      </div>
      <a href="/video_upload" class="upload-btn btn btn-primary">
        <i class="fa-solid fa-upload me-2"></i> Upload a Video
      </a>
    </div>

    <!-- Stats -->
    <div class="stats-grid d-flex gap-3 mb-4">
      <div class="stat-card p-3 shadow-sm flex-grow-1 text-center">
        <i class="fa-solid fa-video fa-2x mb-2"></i>
        <h5>Total Videos</h5>
        <p><%= totalVideos %> Uploaded</p>
      </div>
      <div class="stat-card p-3 shadow-sm flex-grow-1 text-center">
        <i class="fa-solid fa-book fa-2x mb-2"></i>
        <h5>Total Courses</h5>
        <p><%= totalCourses %> Active Courses</p>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="mb-3">
      <input
        type="text"
        id="videoSearch"
        class="form-control shadow-sm"
        placeholder="Search videos by course or topic..."
        style="border-radius: 10px; padding: 10px 15px;"
      />
    </div>

    <!-- Videos Table -->
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Course Name</th>
            <th>Topic</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="videosTable">
          <% if(videos && videos.length > 0) { %>
            <% videos.forEach(video => { %>
              <tr>
                <td class="course-name"><%= video.course %></td>
                <td class="video-topic"><%= video.topic %></td>
                <td><%= video.createdAt.toISOString().split('T')[0] %></td>
                <td>
                  <form action="/video/delete/<%= video._id %>" method="POST" onsubmit="return confirm('Are you sure?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="fa-solid fa-trash"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="4" class="text-center">No videos uploaded yet.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </main>
</div>

<script>
  // Client-side search filter
  const searchInput = document.getElementById("videoSearch");
  const tableRows = document.querySelectorAll("#videosTable tr");

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();

    tableRows.forEach(row => {
      const course = row.querySelector(".course-name")?.textContent.toLowerCase() || "";
      const topic = row.querySelector(".video-topic")?.textContent.toLowerCase() || "";

      if (course.includes(query) || topic.includes(query)) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  });
</script>
