<% layout('layouts/boilerplate') %>

<div class="main-wrapper d-flex">
  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content flex-grow-1 p-4" style="background-color: #f4f7fb;">
    <div class="container-fluid">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <div class="mb-2">
          <h2 class="fw-bold" style="color: #003366;"><%= courseName %></h2>
          <p class="text-secondary mb-0">Watch and learn course topics</p>
        </div>

        <!-- Back Button -->
        <a href="/courses"
           class="btn btn-outline-primary px-3 py-1"
           style="border-radius: 8px; font-size: 0.9rem; display: flex; align-items: center;">
          <i class="fa-solid fa-arrow-left me-2" style="font-size: 0.85rem;"></i> Back
        </a>
      </div>

      <!-- Course Layout -->
      <div class="d-flex flex-wrap" style="gap: 20px;">
        
        <!-- Topics Sidebar -->
        <aside class="p-3 bg-white shadow-sm sidebar-course"
          style="width: 300px; border-radius: 12px; height: fit-content; max-height: 85vh; overflow-y: auto;">
          <h5 class="fw-semibold mb-3" style="color: #003366;">Course Topics</h5>
          <ul class="list-unstyled mb-0">
            <% videos.forEach(video => { %>
              <% const isActive = currentVideo && video._id.toString() === currentVideo._id.toString(); %>
              <li class="mb-2">
                <a href="/course/<%= encodeURIComponent(video.course) %>?v=<%= video._id %>"
                   class="d-block text-decoration-none px-3 py-2 topic-link <%= isActive ? 'active-topic' : '' %>"
                   style="border-radius: 6px; transition: background 0.2s;">
                   <%= video.topic %>
                </a>
              </li>
            <% }) %>
          </ul>
        </aside>

        <!-- Video + Summary -->
        <section class="flex-grow-1 bg-white shadow-sm p-4 d-flex flex-wrap align-items-start"
          style="border-radius: 12px; min-width: 500px; gap: 20px;">
          <% if (currentVideo) { %>
            <!-- Left: Video -->
            <div class="flex-grow-1 text-center" style="min-width: 500px;">
              <video controls poster="<%= currentVideo.thumbnailUrl %>"
                     style="width: 100%; max-width: 850px; border-radius: 12px;">
                <source src="<%= currentVideo.videoUrl %>" type="video/mp4" />
                Your browser does not support the video tag.
              </video>

              <div class="mt-3 text-start">
                <h4 class="fw-semibold" style="color: #003366;">
                  <i class="fa-solid fa-play-circle me-2"></i> <%= currentVideo.topic %>
                </h4>

                <% if (currentVideo.description) { %>
                  <p class="text-secondary mt-1 mb-0">
                    <strong>Description:</strong> <%= currentVideo.description %>
                  </p>
                <% } %>
              </div>
            </div>

            <!-- Right: Summary -->
            <% if (currentVideo.summary) { %>
              <div class="bg-light p-3 rounded shadow-sm"
                   style="width: 280px; border-left: 4px solid #003366; height: fit-content; position: sticky; top: 80px;">
                <h6 class="fw-bold mb-2" style="color: #003366;">Summary</h6>
                <p class="mb-0"><%= currentVideo.summary %></p>
              </div>
            <% } %>
          <% } else { %>
            <p class="text-secondary text-center mt-5">Select a topic to start learning.</p>
          <% } %>
        </section>
      </div>
    </div>
  </main>
</div>

<!-- ✅ Toggle Script -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggleBtn = document.getElementById("toggle-btn");
  const sidebar = document.getElementById("sidebar");
  const mainWrapper = document.querySelector(".main-wrapper");

  if (toggleBtn && sidebar && mainWrapper) {
    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("active");
      mainWrapper.classList.toggle("shifted");
    });
  } else {
    console.warn("Sidebar toggle not initialized — missing elements");
  }
});
</script>

<!-- ✅ Responsive Fix -->
<style>
@media (max-width: 992px) {
  .sidebar-course {
    width: 100%;
    max-height: none;
    order: 2;
  }
  .main-content {
    padding: 1rem !important;
  }
  video {
    max-width: 100% !important;
  }
  section {
    flex-direction: column;
  }
  .bg-light {
    width: 100% !important;
    position: static !important;
    margin-top: 1rem;
  }
  a.btn.btn-outline-primary {
    font-size: 0.85rem !important;
    padding: 4px 10px !important;
  }
}
</style>


