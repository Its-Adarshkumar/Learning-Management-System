<% layout('layouts/boilerplate') %>

<div class="d-flex">

  <!-- Main Video Content -->
  <main class="main-content flex-grow-1 p-4" style="background-color: #f4f7fb;">
    <div class="container-fluid">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold" style="color: #003366;"><%= courseName %></h2>
          <p class="text-secondary mb-0">Watch and learn course topics</p>
        </div>
        <a href="/courses" class="btn btn-outline-primary" style="border-radius: 10px;">
          <i class="fa-solid fa-arrow-left me-2"></i> Go Back
        </a>
      </div>

      <!-- Course Layout -->
      <div class="d-flex flex-wrap" style="gap: 20px;">
        
        <!-- Topics Sidebar -->
        <aside
          class="p-3 bg-white shadow-sm"
          style="width: 300px; border-radius: 12px; height: fit-content; max-height: 85vh; overflow-y: auto;"
        >
          <h5 class="fw-semibold mb-3" style="color: #003366;">Course Topics</h5>
          <ul class="list-unstyled mb-0">
            <% videos.forEach(video => { %>
              <% const isActive = currentVideo && video._id.toString() === currentVideo._id.toString(); %>
              <li class="mb-2">
                <a
                  href="/course/<%= encodeURIComponent(video.course) %>?v=<%= video._id %>"
                  class="d-block text-decoration-none px-3 py-2 topic-link <%= isActive ? 'active-topic' : '' %>"
                >
                  <%= video.topic %>
                </a>
              </li>
            <% }) %>
          </ul>
        </aside>

        <!-- Video + Summary Section -->
        <section
          class="flex-grow-1 bg-white shadow-sm p-4 d-flex flex-wrap align-items-start"
          style="border-radius: 12px; min-width: 500px; gap: 20px;"
        >
          <% if (currentVideo) { %>
            <!-- Left: Video -->
            <div class="flex-grow-1 text-center" style="min-width: 500px;">
              <video
                controls
                poster="<%= currentVideo.thumbnailUrl %>"
                style="width: 100%; max-width: 850px; border-radius: 12px;"
              >
                <source src="<%= currentVideo.videoUrl %>" type="video/mp4" />
                Your browser does not support the video tag.
              </video>

              <div class="mt-4 text-start">
                <h4 class="fw-semibold" style="color: #003366;">
                  <i class="fa-solid fa-play-circle me-2"></i> <%= currentVideo.topic %>
                </h4>

                <% if (currentVideo.description) { %>
                  <p class="text-secondary mt-2">
                    <strong>Description:</strong> <%= currentVideo.description %>
                  </p>
                <% } %>
              </div>
            </div>

            <!-- Right: Summary -->
            <% if (currentVideo.summary) { %>
              <div
                class="bg-light p-3 rounded shadow-sm"
                style="width: 280px; border-left: 4px solid #003366; height: fit-content; position: sticky; top: 80px;"
              >
                <h6 class="fw-bold mb-2" style="color: #003366;">Summary</h6>
                <p class="mb-0"><%= currentVideo.summary %></p>
              </div>
            <% } %>
          <% } else { %>
            <p class="text-secondary text-center mt-5">Select a topic to start learning.</p>
          <% } %>
        </section>
      </div>
    </div>
  </main>
</div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
  const toggleBtn = document.getElementById("toggle-btn");
  const sidebar = document.getElementById("sidebar"); // ✅ note: using ID
  const main = document.querySelector(".main-wrapper");

  if (toggleBtn && sidebar && main) {
    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("active");
      main.classList.toggle("shifted");
    });
  } else {
    console.warn("Sidebar toggle not initialized — element(s) missing");
  }
});

    </script>